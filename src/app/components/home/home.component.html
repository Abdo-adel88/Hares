<div class="vh-100 overflow-hidden">
  <div class="row m-0 p-0">
    <!-- side bar componenttttttttttttttttttttttttt -->
    <div
      *ngIf="isLoading"
      class="wf-div p-0 m-0 d-flex flex-column align-items-center"
    >
      <div
        class="side-nav d-flex flex-column align-items-center justify-content-between py-4"
      >
        <div
          class="d-flex flex-column align-items-center justify-content-center"
        >
          <p-skeleton shape="circle" size="2rem" class="mb-3"></p-skeleton>
          <p-skeleton shape="circle" size="2rem" class="mb-3"></p-skeleton>
          <p-skeleton shape="circle" size="2rem" class="mb-3"></p-skeleton>
          <p-skeleton shape="circle" size="2rem" class="mb-3"></p-skeleton>
          <p-skeleton shape="circle" size="2rem" class="mb-3"></p-skeleton>
        </div>
        <hr />
        <p-skeleton shape="circle" size="2rem" class="mb-3"></p-skeleton>
      </div>
    </div>

    <div
      *ngIf="!isLoading"
      class="wf-div p-0 m-0 d-flex flex-column align-items-center"
    >
      <div
        class="side-nav d-flex flex-column align-items-center justify-content-between py-4"
      >
        <div
          class="d-flex flex-column align-items-center justify-content-center"
        >
          <button
            class="btn mb-4 cursor-pointer d-flex flex-column align-items-center justify-content-center"
          >
            <i class="fas fa-bars fa-lg"></i>
          </button>
          <div class="icon mb-4 position-relative btn text-center">
            <i class="fa-solid fa-comment btn text-center"></i>
            <span class="badge">40</span>
          </div>
          <div class="icon mb-4 btn text-center">
            <i class="fas fa-phone fa-lg text-center"></i>
          </div>
          <div class="icon mb-4 position-relative btn">
            <i class="fas fa-compass fa-lg"></i>
            <span class="dot"></span>
          </div>
          <div class="icon mb-4 btn">
            <i class="fas fa-star fa-lg"></i>
          </div>
          <div class="icon mb-4 btn">
            <i class="fas fa-trash fa-lg"></i>
          </div>
        </div>
        <hr />
        <div class="icon mb-4 btn">
          <!--  -->
          <div class="btn-group dropend" role="group">
            <button
              type="button"
              class="btn btn-primary dropdown-toggle"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <i class="fas fa-cog fa-lg"></i>
            </button>
            <ul class="dropdown-menu" (click)="logout()">
              <li>
                <div class="dropdown-items ps-2">
                  <i class="fa-solid fa-arrow-right-from-bracket"></i> Logout
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!--  left componenttttttttttttttttttttttttt -->
    <div *ngIf="isLoading" class="col-3 m-0 p-0">
      <div class="vh-100 p-3 chats text-black">
        <div class="d-flex align-items-center justify-content-between">
          <h2>chats</h2>
          <div>
            <i class="fa-regular fa-pen-to-square"></i>
            <i class="fa-solid fa-bars ms-2"></i>
          </div>
        </div>
        <div
          *ngFor="let item of [1, 2, 3, 4, 5, 6, 7, 8]"
          class="d-flex align-items-center justify-content-between chat-item mt-4"
        >
          <div class="d-flex align-items-center justify-content-between">
            <p-skeleton shape="circle" size="50px" class="me-3"></p-skeleton>
            <p-skeleton width="280px" height="1.5rem" class=""></p-skeleton>
          </div>
        </div>
      </div>
    </div>
    <div *ngIf="!isLoading" class="col-3 m-0 p-0">
      <div class="vh-100 p-3 chats text-black">
        <div class="d-flex align-items-center justify-content-between">
          <h2>chats</h2>
          <div>
            <i class="fa-regular fa-pen-to-square"></i>
            <i class="fa-solid fa-bars ms-2"></i>
          </div>
        </div>

        <div class="group w-100">
          <svg viewBox="0 0 24 24" aria-hidden="true" class="icons">
            <g>
              <path
                d="M21.53 20.47l-3.66-3.66C19.195 15.24 20 13.214 20 11c0-4.97-4.03-9-9-9s-9 4.03-9 9 4.03 9 9 9c2.215 0 4.24-.804 5.808-2.13l3.66 3.66c.147.146.34.22.53.22s.385-.073.53-.22c.295-.293.295-.767.002-1.06zM3.5 11c0-4.135 3.365-7.5 7.5-7.5s7.5 3.365 7.5 7.5-3.365 7.5-7.5 7.5-7.5-3.365-7.5-7.5z"
              ></path>
            </g>
          </svg>
          <input class="input w-100" type="search" placeholder="Search" />
        </div>
        <div class="chats-container">
          <div *ngIf="!isLoading" class="chats-container">
            <div
              *ngFor="let chat of chatList"
              (click)="loadMessages(chat.id)"
              class="d-flex align-items-center justify-content-between chat-item mt-4"
              style="cursor: pointer"
            >
              <div
                class="d-flex align-items-center justify-content-between chat-item w-100"
              >
                <!-- أيقونة الملف الشخصي -->
                <div class="d-flex align-items-center">
                  <img
                    src="assets/images/istockphoto-1495088043-612x612.png"
                    width="55px"
                    height="55px"
                    class="rounded-circle"
                    alt="User Profile"
                  />
                  <div class="ms-3">
                    <!-- اسم المستخدم وعنوان البريد الإلكتروني -->
                    <h6 class="mb-0">{{ chat.name }}</h6>
                    <p
                      class="mb-0"
                      [title]="chat.msg && chat.msg.length > 12 ? chat.msg : ''"
                    >
                      {{
                        chat.msg && chat.msg.length > 14
                          ? (chat.msg | slice : 0 : 14) + "..."
                          : chat.msg || "لا توجد رسائل"
                      }}
                    </p>
                  </div>
                </div>

                <!-- وقت آخر رسالة وعدد الرسائل الجديدة -->
                <div class="text-end">
                  <p class="text.main mb-0">{{ chat.time }}</p>
                  <span class="badge bg-main">{{ chat.numMsg }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- right componentttttttttttttttttttttttttt defualt -->
    
    <!-- right componentttttttttttttttttttttttttt -->
    <div *ngIf="isLoading"
      class="chat-window col-8-last bg-chat m-0 p-0 text-start"
    >
      <div *ngIf="isLoading">
        <p-skeleton width="100%" height="3rem" class="my-2"></p-skeleton>

        <div class="my-5 py-1">
          <p-skeleton width="10%" height="2rem" class="mb-3"></p-skeleton>
        </div>

        <div class="my-5 py-1">
          <p-skeleton width="20%" height="2rem" class="mb-3"></p-skeleton>
        </div>

        <div class="my-5 py-1">
          <p-skeleton width="40%" height="2rem" class="mb-3"></p-skeleton>
        </div>

        <div class="my-5 py-1">
          <p-skeleton width="50%" height="2rem" class="mb-3"></p-skeleton>
        </div>
        <div class="my-5 py-1">
          <p-skeleton width="60%" height="2rem" class="mb-3"></p-skeleton>
        </div>
        <div class="my-5 py-1">
          <p-skeleton width="70%" height="2rem" class="mb-3"></p-skeleton>
        </div>
        <div class="mt-5 py-1">
          <p-skeleton width="70%" height="2rem" class="mb-3"></p-skeleton>
        </div>

        <div class="chat-input mt-2">
          <input
            type="text"
            [(ngModel)]="newMessage"
            placeholder="Message"
            (keydown.enter)="sendMessage()"
          />
          <button (click)="sendMessage()">Send</button>
        </div>
      </div>
    </div>
    <div  class=" col-8-last  m-0 p-0">
      <div class="chat-window bg-chat" *ngIf="!isLoading && currentChatId; else defaultView">
        <div class="chat-header">
          <img
            src="assets/images/istockphoto-1495088043-612x612.png"
            width="50px"
            height="50px"
            class="rounded-circle"
            alt=""
          />
          <div class="user-info">
            <h3>{{ currentChatName }}</h3>
  
            <span>last seen 5 mins ago</span>
          </div>
        </div>
        <div class="chat-body" id="chat-body">
          <div
            *ngFor="let message of messages; let i = index"
            [ngClass]="{
              'message-sent': message.senderId === loggedInUserId,
              'message-received': message.senderId !== loggedInUserId
            }"
            class="d-flex align-items-center justify-content-end flex-column"
          >
            <div class="message my-2 position-relative">
              <i
                class="fa-solid fa-ellipsis-vertical position-absolute list-bar"
                (click)="toggleOptions(i)"
                style="cursor: pointer"
              >
              </i>
  
              <span *ngIf="message.text">{{ message.text }}</span>
  
              <div
                class="message-meta d-flex align-items-center justify-content-between"
              >
                <span *ngIf="message.time">{{ message.time }}</span>
                <span class="check">
                  <i class="fa-solid fa-check-double text-primary"></i>
                </span>
              </div>
  
              <div
                *ngIf="selectedMessageIndex === i"
                class="dropdown-menu-1 p-2 show position-absolute"
                style="
                  top: 100%;
                  right: 0;
                  min-width: 150px;
                  background-color: #0d0c22;
                  color: #fff !important;
                "
              >
                <a class="dropdown-item text-white p-1" (click)="editMessage(i)"
                  >Edit</a
                >
                <a class="dropdown-item text-white p-1" (click)="deleteMessage(i)"
                  >Delete</a
                >
              </div>
            </div>
          </div>
        </div>
        <div class="chat-input">
          <input
            type="text"
            [(ngModel)]="newMessage"
            placeholder="Message"
            (keydown.enter)="sendMessage()"
          />
          <button (click)="sendMessage()">
            {{ isEditing ? "Update" : "Send" }}
          </button>
        </div>
      </div>
      
      <ng-template #defaultView>
        <app-default-view></app-default-view>
      </ng-template>
    </div>
  </div>
</div>
